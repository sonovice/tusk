# Roundtrip Testing Tasks

Tasks generated from MusicXML → MEI → MusicXML roundtrip tests. Each task documents a missing conversion, unsupported element, or discrepancy found during testing.

**Legend**: `[ ]` = pending, `[x]` = done

**Workflow**: The `tusk_roundtrip.sh` script both implements existing tasks AND generates new ones when issues are discovered during roundtrip testing.

---

## Initial Roundtrip Infrastructure

### Setup
- [x] Create roundtrip test harness in `crates/formats/musicxml/tests/roundtrip.rs`
- [x] Add test helper: parse MusicXML → convert to MEI → convert back to MusicXML
- [x] Add comparison logic to detect differences between input and output
- [x] Run roundtrip tests on all fixtures in `tests/fixtures/musicxml/`

### Basic Fixtures
- [x] Roundtrip test: `hello_world.musicxml`
- [x] Roundtrip test: `scale.musicxml`
- [x] Roundtrip test: `durations.musicxml`
- [x] Roundtrip test: `chords_and_rests.musicxml`
- [x] Roundtrip test: `high_divisions.musicxml`
- [x] Roundtrip test: `directions.musicxml`

### Spec Example Fixtures
- [x] Roundtrip test: `specs/musicxml/examples/Telemann.musicxml`
- [x] Roundtrip test: `specs/musicxml/examples/Binchois.musicxml`
- [x] Roundtrip test: `specs/musicxml/examples/MozartPianoSonata.musicxml`

---

## Completed Bug Fixes

- [x] [BUGFIX] Clef selection used global staff number instead of part-internal staff number (source: Telemann.musicxml)
  - Multi-staff parts (like piano) have clefs with `number=1` and `number=2` within the part
  - Fixed to use `number=1` or `None` for first staffDef of each part

---

## Generated Tasks

<!-- Tasks below this line are auto-generated by tusk_roundtrip.sh -->
<!-- Format: - [ ] [CATEGORY] Description (source: filename.musicxml) -->

---
